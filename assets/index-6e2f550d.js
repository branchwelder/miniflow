(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var B;const N=window,P=N.trustedTypes,X=P?P.createPolicy("lit-html",{createHTML:e=>e}):void 0,W="$lit$",b=`lit$${(Math.random()+"").slice(9)}$`,rt="?"+b,At=`<${rt}>`,E=document,C=()=>E.createComment(""),T=e=>e===null||typeof e!="object"&&typeof e!="function",at=Array.isArray,xt=e=>at(e)||typeof(e==null?void 0:e[Symbol.iterator])=="function",U=`[ 	
\f\r]`,I=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Z=/-->/g,K=/>/g,A=RegExp(`>|${U}(?:([^\\s"'>=/]+)(${U}*=${U}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Q=/'/g,G=/"/g,lt=/^(?:script|style|textarea|title)$/i,ct=e=>(t,...n)=>({_$litType$:e,strings:t,values:n}),$=ct(1),J=ct(2),D=Symbol.for("lit-noChange"),v=Symbol.for("lit-nothing"),tt=new WeakMap,x=E.createTreeWalker(E,129,null,!1);function dt(e,t){if(!Array.isArray(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return X!==void 0?X.createHTML(t):t}const Et=(e,t)=>{const n=e.length-1,i=[];let o,s=t===2?"<svg>":"",r=I;for(let l=0;l<n;l++){const c=e[l];let d,u,p=-1,m=0;for(;m<c.length&&(r.lastIndex=m,u=r.exec(c),u!==null);)m=r.lastIndex,r===I?u[1]==="!--"?r=Z:u[1]!==void 0?r=K:u[2]!==void 0?(lt.test(u[2])&&(o=RegExp("</"+u[2],"g")),r=A):u[3]!==void 0&&(r=A):r===A?u[0]===">"?(r=o??I,p=-1):u[1]===void 0?p=-2:(p=r.lastIndex-u[2].length,d=u[1],r=u[3]===void 0?A:u[3]==='"'?G:Q):r===G||r===Q?r=A:r===Z||r===K?r=I:(r=A,o=void 0);const _=r===A&&e[l+1].startsWith("/>")?" ":"";s+=r===I?c+At:p>=0?(i.push(d),c.slice(0,p)+W+c.slice(p)+b+_):c+b+(p===-2?(i.push(void 0),l):_)}return[dt(e,s+(e[n]||"<?>")+(t===2?"</svg>":"")),i]};class j{constructor({strings:t,_$litType$:n},i){let o;this.parts=[];let s=0,r=0;const l=t.length-1,c=this.parts,[d,u]=Et(t,n);if(this.el=j.createElement(d,i),x.currentNode=this.el.content,n===2){const p=this.el.content,m=p.firstChild;m.remove(),p.append(...m.childNodes)}for(;(o=x.nextNode())!==null&&c.length<l;){if(o.nodeType===1){if(o.hasAttributes()){const p=[];for(const m of o.getAttributeNames())if(m.endsWith(W)||m.startsWith(b)){const _=u[r++];if(p.push(m),_!==void 0){const bt=o.getAttribute(_.toLowerCase()+W).split(b),R=/([.?@])?(.*)/.exec(_);c.push({type:1,index:s,name:R[2],strings:bt,ctor:R[1]==="."?Pt:R[1]==="?"?It:R[1]==="@"?Ot:M})}else c.push({type:6,index:s})}for(const m of p)o.removeAttribute(m)}if(lt.test(o.tagName)){const p=o.textContent.split(b),m=p.length-1;if(m>0){o.textContent=P?P.emptyScript:"";for(let _=0;_<m;_++)o.append(p[_],C()),x.nextNode(),c.push({type:2,index:++s});o.append(p[m],C())}}}else if(o.nodeType===8)if(o.data===rt)c.push({type:2,index:s});else{let p=-1;for(;(p=o.data.indexOf(b,p+1))!==-1;)c.push({type:7,index:s}),p+=b.length-1}s++}}static createElement(t,n){const i=E.createElement("template");return i.innerHTML=t,i}}function L(e,t,n=e,i){var o,s,r,l;if(t===D)return t;let c=i!==void 0?(o=n._$Co)===null||o===void 0?void 0:o[i]:n._$Cl;const d=T(t)?void 0:t._$litDirective$;return(c==null?void 0:c.constructor)!==d&&((s=c==null?void 0:c._$AO)===null||s===void 0||s.call(c,!1),d===void 0?c=void 0:(c=new d(e),c._$AT(e,n,i)),i!==void 0?((r=(l=n)._$Co)!==null&&r!==void 0?r:l._$Co=[])[i]=c:n._$Cl=c),c!==void 0&&(t=L(e,c._$AS(e,t.values),c,i)),t}class wt{constructor(t,n){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=n}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){var n;const{el:{content:i},parts:o}=this._$AD,s=((n=t==null?void 0:t.creationScope)!==null&&n!==void 0?n:E).importNode(i,!0);x.currentNode=s;let r=x.nextNode(),l=0,c=0,d=o[0];for(;d!==void 0;){if(l===d.index){let u;d.type===2?u=new S(r,r.nextSibling,this,t):d.type===1?u=new d.ctor(r,d.name,d.strings,this,t):d.type===6&&(u=new Ct(r,this,t)),this._$AV.push(u),d=o[++c]}l!==(d==null?void 0:d.index)&&(r=x.nextNode(),l++)}return x.currentNode=E,s}v(t){let n=0;for(const i of this._$AV)i!==void 0&&(i.strings!==void 0?(i._$AI(t,i,n),n+=i.strings.length-2):i._$AI(t[n])),n++}}class S{constructor(t,n,i,o){var s;this.type=2,this._$AH=v,this._$AN=void 0,this._$AA=t,this._$AB=n,this._$AM=i,this.options=o,this._$Cp=(s=o==null?void 0:o.isConnected)===null||s===void 0||s}get _$AU(){var t,n;return(n=(t=this._$AM)===null||t===void 0?void 0:t._$AU)!==null&&n!==void 0?n:this._$Cp}get parentNode(){let t=this._$AA.parentNode;const n=this._$AM;return n!==void 0&&(t==null?void 0:t.nodeType)===11&&(t=n.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,n=this){t=L(this,t,n),T(t)?t===v||t==null||t===""?(this._$AH!==v&&this._$AR(),this._$AH=v):t!==this._$AH&&t!==D&&this._(t):t._$litType$!==void 0?this.g(t):t.nodeType!==void 0?this.$(t):xt(t)?this.T(t):this._(t)}k(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}$(t){this._$AH!==t&&(this._$AR(),this._$AH=this.k(t))}_(t){this._$AH!==v&&T(this._$AH)?this._$AA.nextSibling.data=t:this.$(E.createTextNode(t)),this._$AH=t}g(t){var n;const{values:i,_$litType$:o}=t,s=typeof o=="number"?this._$AC(t):(o.el===void 0&&(o.el=j.createElement(dt(o.h,o.h[0]),this.options)),o);if(((n=this._$AH)===null||n===void 0?void 0:n._$AD)===s)this._$AH.v(i);else{const r=new wt(s,this),l=r.u(this.options);r.v(i),this.$(l),this._$AH=r}}_$AC(t){let n=tt.get(t.strings);return n===void 0&&tt.set(t.strings,n=new j(t)),n}T(t){at(this._$AH)||(this._$AH=[],this._$AR());const n=this._$AH;let i,o=0;for(const s of t)o===n.length?n.push(i=new S(this.k(C()),this.k(C()),this,this.options)):i=n[o],i._$AI(s),o++;o<n.length&&(this._$AR(i&&i._$AB.nextSibling,o),n.length=o)}_$AR(t=this._$AA.nextSibling,n){var i;for((i=this._$AP)===null||i===void 0||i.call(this,!1,!0,n);t&&t!==this._$AB;){const o=t.nextSibling;t.remove(),t=o}}setConnected(t){var n;this._$AM===void 0&&(this._$Cp=t,(n=this._$AP)===null||n===void 0||n.call(this,t))}}class M{constructor(t,n,i,o,s){this.type=1,this._$AH=v,this._$AN=void 0,this.element=t,this.name=n,this._$AM=o,this.options=s,i.length>2||i[0]!==""||i[1]!==""?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=v}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(t,n=this,i,o){const s=this.strings;let r=!1;if(s===void 0)t=L(this,t,n,0),r=!T(t)||t!==this._$AH&&t!==D,r&&(this._$AH=t);else{const l=t;let c,d;for(t=s[0],c=0;c<s.length-1;c++)d=L(this,l[i+c],n,c),d===D&&(d=this._$AH[c]),r||(r=!T(d)||d!==this._$AH[c]),d===v?t=v:t!==v&&(t+=(d??"")+s[c+1]),this._$AH[c]=d}r&&!o&&this.j(t)}j(t){t===v?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class Pt extends M{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===v?void 0:t}}const Lt=P?P.emptyScript:"";class It extends M{constructor(){super(...arguments),this.type=4}j(t){t&&t!==v?this.element.setAttribute(this.name,Lt):this.element.removeAttribute(this.name)}}class Ot extends M{constructor(t,n,i,o,s){super(t,n,i,o,s),this.type=5}_$AI(t,n=this){var i;if((t=(i=L(this,t,n,0))!==null&&i!==void 0?i:v)===D)return;const o=this._$AH,s=t===v&&o!==v||t.capture!==o.capture||t.once!==o.once||t.passive!==o.passive,r=t!==v&&(o===v||s);s&&this.element.removeEventListener(this.name,this,o),r&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var n,i;typeof this._$AH=="function"?this._$AH.call((i=(n=this.options)===null||n===void 0?void 0:n.host)!==null&&i!==void 0?i:this.element,t):this._$AH.handleEvent(t)}}class Ct{constructor(t,n,i){this.element=t,this.type=6,this._$AN=void 0,this._$AM=n,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(t){L(this,t)}}const et=N.litHtmlPolyfillSupport;et==null||et(j,S),((B=N.litHtmlVersions)!==null&&B!==void 0?B:N.litHtmlVersions=[]).push("2.8.0");const k=(e,t,n)=>{var i,o;const s=(i=n==null?void 0:n.renderBefore)!==null&&i!==void 0?i:t;let r=s._$litPart$;if(r===void 0){const l=(o=n==null?void 0:n.renderBefore)!==null&&o!==void 0?o:null;s._$litPart$=r=new S(t.insertBefore(C(),l),l,void 0,n??{})}return r._$AI(e),r};/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function Tt(e,t,n){return e?t():n==null?void 0:n()}const Dt="modulepreload",jt=function(e){return"/miniflow/"+e},nt={},h=function(t,n,i){if(!n||n.length===0)return t();const o=document.getElementsByTagName("link");return Promise.all(n.map(s=>{if(s=jt(s),s in nt)return;nt[s]=!0;const r=s.endsWith(".css"),l=r?'[rel="stylesheet"]':"";if(!!i)for(let u=o.length-1;u>=0;u--){const p=o[u];if(p.href===s&&(!r||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${l}`))return;const d=document.createElement("link");if(d.rel=r?"stylesheet":Dt,r||(d.as="script",d.crossOrigin=""),d.href=s,document.head.appendChild(d),r)return new Promise((u,p)=>{d.addEventListener("load",u),d.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>t()).catch(s=>{const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=s,window.dispatchEvent(r),!r.defaultPrevented)throw s})};class y{constructor(t={},n={}){this.tools=t,this.pipes=n}toJSON(){return{tools:Object.fromEntries(Object.entries(this.tools).map(([n,i])=>[n,{state:i.saveState(i.state),path:i.path}])),pipes:this.pipes}}rootTools(){return Object.fromEntries(Object.entries(this.tools).filter(([t,n])=>Object.keys(n.inputs).every(i=>!this.connectedOutput(t,i))))}getConnectedPipes(t){return Object.fromEntries(Object.entries(this.pipes).filter(([n,i])=>i.start.toolID==t||i.end.toolID==t))}addTool(t,n){return new y({...this.tools,[t]:n},this.pipes)}deleteTool(t){const n=this.getConnectedPipes(t),i={};Object.entries(this.pipes).forEach(([r,l])=>{r in n||(i[r]=l)});const{[t]:o,...s}=this.tools;return new y(s,i)}addPipe(t,n,i){if(n.toolID==i.toolID){console.log("Can't connect a tool to itself!");return}let o=this.connectedOutput(i.toolID,i.portID);if(o){const{[o.pipeID]:s,...r}=this.pipes;return new y({...this.tools},{...r,[t]:{start:n,end:i}})}return new y({...this.tools},{...this.pipes,[t]:{start:n,end:i}})}deletePipe(t){const{[t]:n,...i}=this.pipes;return new y({...this.tools},i)}connectedInputs(t,n){return Object.entries(this.pipes).filter(([i,o])=>o.start.toolID==t&&o.start.portID==n)}connectedOutput(t,n){for(const i of Object.entries(this.pipes)){let[o,s]=i;if(s.end.toolID==t&&s.end.portID==n)return{pipeID:o,pipeData:s}}return!1}}const kt={"--pink":"#ff79c6","--red":"#ff5555","--orange":"#ffad55","--yellow":"#fcef3e","--green":"#50fa7b","--cyan":"#8be9fd","--blue":"#4395d4","--purple":"#9674c8","--gray":"#848484","--black":"#282a36","--black-accent":"#353745","--inactive":"#b4b4b4","--text-light":"#f8f8f2","--text-dark":"#282a36","--pipe":"#b7b7b7","--background":"#44475a","--toolbar":"#282a36","--tool-background":"#f8f8f2","--tool-background-accent":"#d5d5d5","--background-dots":"#d6cce0","--port":"#b7b7b7","--port-hover":"#e7e7e7"},ut=["toolchain","layout"],St=1e3;let a={title:"toolchain",toolchain:new y,toolbox:Object.assign({"./tools/add.js":()=>h(()=>import("./add-e3b7699b.js"),[]).then(e=>e.default),"./tools/audio/audioAnalyser.js":()=>h(()=>import("./audioAnalyser-cdafbe3e.js"),[]).then(e=>e.default),"./tools/audio/audioDestination.js":()=>h(()=>import("./audioDestination-694c9e25.js"),[]).then(e=>e.default),"./tools/audio/biquadFilter.js":()=>h(()=>import("./biquadFilter-af7667aa.js"),[]).then(e=>e.default),"./tools/audio/convolver.js":()=>h(()=>import("./convolver-4def7afc.js"),[]).then(e=>e.default),"./tools/audio/distortion.js":()=>h(()=>import("./distortion-dad875d1.js"),[]).then(e=>e.default),"./tools/audio/gain.js":()=>h(()=>import("./gain-3c3ec6a8.js"),[]).then(e=>e.default),"./tools/audio/mediaStreamSource.js":()=>h(()=>import("./mediaStreamSource-53950084.js"),[]).then(e=>e.default),"./tools/audio/oscillator.js":()=>h(()=>import("./oscillator-a6d1476c.js"),[]).then(e=>e.default),"./tools/audio/playPause.js":()=>h(()=>import("./playPause-16d120ab.js"),[]).then(e=>e.default),"./tools/audio/sweep.js":()=>h(()=>import("./sweep-2e5f8d86.js"),[]).then(e=>e.default),"./tools/commandSet.js":()=>h(()=>import("./commandSet-2eb096a0.js"),[]).then(e=>e.default),"./tools/dataViewer.js":()=>h(()=>import("./dataViewer-7b5b12c8.js"),[]).then(e=>e.default),"./tools/inputs/inputNumber.js":()=>h(()=>import("./inputNumber-a749bebf.js"),[]).then(e=>e.default),"./tools/inputs/microphone.js":()=>h(()=>import("./microphone-bc1e0c2d.js"),[]).then(e=>e.default),"./tools/serial/serialPort.js":()=>h(()=>import("./serialPort-858c6e2c.js"),[]).then(e=>e.default),"./tools/serial/serialReader.js":()=>h(()=>import("./serialReader-06640b89.js"),[]).then(e=>e.default),"./tools/serial/serialWriter.js":()=>h(()=>import("./serialWriter-5e2456c8.js"),[]).then(e=>e.default)}),examples:Object.assign({"./examples/audioAnalyser.json":()=>h(()=>import("./audioAnalyser-0a010b42.js"),[]).then(e=>e.default),"./examples/axidrawSerial.json":()=>h(()=>import("./axidrawSerial-2c980fe3.js"),[]).then(e=>e.default),"./examples/voicechanger.json":()=>h(()=>import("./voicechanger-40058016.js"),[]).then(e=>e.default)}),danglingPipe:null,layout:{},portInspection:{},pan:{x:0,y:0},scale:1,lastSnapshot:0,transforming:!1,snapshots:[],global:{audioContext:new(window.AudioContext||window.webkitAudioContext)},selectBox:{start:null,end:null},heldKeys:new Set,showExamples:!1,theme:kt,colors:{Number:"--cyan",Object:"--purple",Boolean:"--purple",String:"--yellow",Undefined:"--red"}};function Rt(e){if(!(a.lastSnapshot<Date.now()-St))return!1;for(const t of ut)if(t in e)return!0;return!1}function Nt(e){return a={...a,...e,snapshots:[Object.fromEntries(ut.map(t=>[t,a[t]])),...a.snapshots],lastSnapshot:Date.now()},a}function Ht(e){return a={...a,...e},a}function Mt(e){return Rt(e)?Nt(e):Ht(e)}function Vt(){if(a.snapshots.length<1)return;const e=Object.keys(a.snapshots[0]);a={...a,...a.snapshots[0],lastSnapshot:0,snapshots:a.snapshots.slice(1)},O.notify(e)}async function f(e){const t=Object.keys(e);return new Promise(n=>{Mt(e),O.notify(t),n(t)})}const O=(()=>{const e=Object.fromEntries(Object.keys(a).map(o=>[o,new Set]));function t(o){o.forEach(s=>e[s].forEach(r=>r()))}function n(o,...s){s.forEach(r=>e[o].add(r))}function i(o,...s){s.forEach(r=>e[o].delete(r))}return{subscribe:n,notify:t,unsubscribe:i}})();function g(e){return{x:e.clientX,y:e.clientY}}function Bt(e,t){return`${e.toolID}_${e.portID}_${t.toolID}_${t.portID}`}function w({x:e,y:t}){const n=document.getElementById("workspace").getBoundingClientRect();return{x:(e-a.pan.x)/a.scale,y:(t-a.pan.y)/a.scale-n.top/a.scale}}function H(e){const t=e.getBoundingClientRect();return w({x:t.left+t.width/2,y:t.top+t.height/2})}function Ut(e,t,n){return n==="in"?a.toolchain.tools[e].inputConfig[t]:a.toolchain.tools[e].outputConfig[t]}function pt(e,t,n){const i=Ut(e,t,n).type;return a.colors[i]??"--purple"}function ot(e){return{toolID:e.closest(".tool").dataset.toolid,portID:e.dataset.portid}}function V(e){return e.split("/").at(-1).split(".")[0]}function q({toolID:e,portID:t},n){return document.querySelector(`[data-toolid="${e}"] [data-portside=${n}][data-portid="${t}"]`)}function Wt(e,t){let n={...a.layout[t]},i=g(e);const o=e.target;o.setPointerCapture(e.pointerId),o.classList.remove("grab"),o.classList.add("grabbing"),f({transforming:!0});function s(l){f({transforming:!1}),o.classList.add("grab"),o.classList.remove("grabbing"),o.removeEventListener("pointermove",r),o.removeEventListener("pointerup",s),o.removeEventListener("pointercancel",s)}function r(l){l.preventDefault();let c=n.x-Math.floor((i.x-g(l).x)/a.scale),d=n.y-Math.floor((i.y-g(l).y)/a.scale);f({layout:{...a.layout,[t]:{x:c,y:d}}})}o.addEventListener("pointermove",r),o.addEventListener("pointerup",s),o.addEventListener("pointercancel",s)}function qt(e,t,n,i){let o=g(e),s=g(e);const r=e.target;r.setPointerCapture(e.pointerId),f({transforming:!0});function l(d){let u=document.elementFromPoint(d.clientX,d.clientY);u.classList.contains("port")&&(i=="in"?z(ot(u),{toolID:t,portID:n}):z({toolID:t,portID:n},ot(u))),f({danglingPipe:null,transforming:!1}),r.removeEventListener("pointermove",c),r.removeEventListener("pointerup",l),r.removeEventListener("pointercancel",l)}function c(d){d.preventDefault();const u=g(d);let p=o.x-Math.floor(s.x-u.x),m=o.y-Math.floor(s.y-u.y);f({danglingPipe:{toolID:t,portID:n,originPort:r,side:i,endCoords:w({x:p,y:m})}})}r.addEventListener("pointermove",c),r.addEventListener("pointerup",l),r.addEventListener("pointercancel",l)}function zt(e){return $`<div class="menu-item edit-toolname">
      <i class="edit-toolname fa-solid fa-pen-to-square fa-fw"></i>
      <span class="edit-toolname">Edit Display Name</span>
    </div>
    <div class="menu-item" @click=${t=>ee(e)}>
      <i class="fa-solid fa-trash fa-fw"></i>
      <span class="remove">Delete</span>
    </div>`}function it(e,t,n){return $`<div class="field ${n}">
    <div
      class="port"
      data-portside=${n}
      data-portid=${t}
      @pointerdown=${i=>qt(i,e,t,n)}></div>
    <span>${t}</span>
  </div>`}function Ft(e,t){return $`<div
      class="toolbar grab"
      @pointerdown=${n=>Wt(n,e)}>
      ${t.displayName??V(t.path)}
      <div class="menu-icon">
        <a class="menu" href="#">
          <i class="fa-solid fa-ellipsis-vertical"></i>
        </a>
        <div class="tool-menu">${zt(e)}</div>
      </div>
    </div>
    <div class="tool-content"></div>
    <div class="tooldata">
      ${Object.keys(t.inputs).map(n=>it(e,n,"in"))}
      ${Object.keys(t.outputs).map(n=>it(e,n,"out"))}
    </div>`}function Jt(e){return{get(t,n,i){const o=a.toolchain.connectedOutput(e,n);if(o){const s=o.pipeData.start;return a.toolchain.tools[s.toolID].outputs[s.portID]}},set(t,n,i){console.log("Can't set an input")}}}function Yt(e,t){return{get(n,i,o){return i in e.stateConfig?Reflect.get(...arguments).value:(console.error(`Error!  property "${i}" not in ${e.displayName}'s state`),!0)},set(n,i,o){if(!(i in e.stateConfig))return console.error(`Error!  property "${i}" not in ${e.displayName}'s state`),!0;const s=Reflect.get(...arguments).value;return Reflect.get(...arguments).value=o,e.stateConfig[i].change&&e.stateConfig[i].change(e,o,s),!0}}}function Xt(e,t){return{get(n,i,o){return Reflect.get(...arguments).value},set(n,i,o){const s=Reflect.get(...arguments).value;return Reflect.get(...arguments).value=o,a.toolchain.connectedInputs(t,i).forEach(([l,{start:c,end:d}])=>{const u=a.toolchain.tools[d.toolID],p=u.inputConfig[d.portID];p.change&&p.change(u,o,s)}),!0}}}function Zt(e,t){t.inputs=new Proxy(t.inputConfig,Jt(e)),t.state=new Proxy(t.stateConfig,Yt(t)),t.outputs=new Proxy(t.outputConfig,Xt(t,e))}const Kt={displayName:"Tool",inputConfig:{},stateConfig:{},outputConfig:{},saveState:e=>Object.fromEntries(Object.entries(e).map(([t,n])=>[t,n]))};function Qt(e,t){t.setup&&t.setup(t),t.root=document.createElement("div"),t.root.dataset.toolid=e,t.root.classList.add("tool"),k(Ft(e,t),t.root),t.dom=t.root.querySelector(".tool-content").attachShadow({mode:"open"}),ft(e,t),document.getElementById("tool-ui").appendChild(t.root),t.connected&&t.connected(t)}function ft(e,t){t.render&&t.render(t)}function ht(e,t){e.root.style.cssText=`transform: translate(${t.x}px, ${t.y}px)`}function vt(e,t,n,i){const o={...Kt,...t,path:e,global:a.global};n&&Object.entries(n).forEach(([r,l])=>{l&&Object.keys(l).length===0||(o.stateConfig[r].value=l)});const s=i??crypto.randomUUID();return Zt(s,o),Qt(s,o),{toolID:s,tool:o}}function Gt(e,t){mt(e).then(n=>{const{toolID:i,tool:o}=vt(e,n());f({toolchain:a.toolchain.addTool(i,o),layout:{...a.layout,[i]:t}})})}function mt(e){return e in a.toolbox||console.error(`Error: module at path ${e} not found`),a.toolbox[e]()}function z(e,t){if(e.toolID==t.toolID){console.log("Can't connect a tool to itself!");return}const n=a.toolchain.tools[t.toolID],i=n.inputConfig[t.portID],o=n.inputs[t.portID];f({toolchain:a.toolchain.addPipe(Bt(e,t),e,t)}).then(()=>{i.change&&i.change(n,n.inputs[t.portID],o)})}function te(e){const{start:t,end:n}=a.toolchain.pipes[e],i=a.toolchain.tools[n.toolID],o=i.inputConfig[n.portID],s=i.inputs[n.portID];f({toolchain:a.toolchain.deletePipe(e)}).then(()=>{o.change&&o.change(i,i.inputs[n.portID],s)})}function gt(e){e.disconnected&&e.disconnected(),e.root.remove()}function ee(e){const t=a.toolchain.tools[e];gt(t),t.teardown&&t.teardown(t),f({toolchain:a.toolchain.deleteTool(e)})}function ne(e){a.examples[e]().then(t=>$t(t))}async function $t(e){await _t();const{pan:t,layout:n,scale:i,toolchain:o}=e,s=await Promise.all(Object.entries(o.tools).map(async([r,{path:l,state:c}])=>{const d=await mt(l),{tool:u}=vt(l,d(),c,r);return ht(u,n[r]),[r,u]}));f({toolchain:new y(Object.fromEntries(s),{}),pan:t,layout:n,scale:i}).then(()=>{Object.entries(o.pipes).forEach(([r,{start:l,end:c}])=>{z(l,c)})})}function _t(){return Object.values(a.toolchain.tools).forEach(e=>{gt(e),e.teardown&&e.teardown(e)}),f({layout:{},portInspection:{},toolchain:new y,pan:{x:0,y:0},scale:1})}function oe(){_t()}function ie(){let e=document.createElement("input");e.setAttribute("type","file"),e.style.display="none",document.body.appendChild(e),e.click(),e.onchange=t=>{const n=t.target.files[0],i=new FileReader;i.readAsText(n),i.onload=()=>{$t(JSON.parse(i.result))}},document.body.removeChild(e)}function se(){const e={pan:a.pan,scale:a.scale,layout:a.layout,toolchain:a.toolchain.toJSON()},t=document.createElement("a");t.href="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e)),t.download=`${a.title}.json`,document.body.appendChild(t),t.click(),document.body.removeChild(t)}function re(){return $` <div id="taskbar">
    <span>toolchains</span>
    <div class="taskbar-buttons">
      <button class="taskbar-btn" @click=${()=>Vt()}>
        <i class="fa-solid fa-rotate-left"></i>
      </button>
      <button class="taskbar-btn" @click=${()=>oe()}>
        <i class="fa-solid fa-file"></i>
      </button>

      <button class="taskbar-btn" @click=${()=>ie()}>
        <i class="fa-solid fa-upload"></i>
      </button>
      <button class="taskbar-btn" @click=${()=>se()}>
        <i class="fa-solid fa-download"></i>
      </button>
      <button
        class="taskbar-btn"
        @click=${()=>f({showExamples:!a.showExamples})}>
        <i class="fa-solid fa-book"></i>
      </button>
    </div>
  </div>`}function ae(e,t){g(e),f({transforming:!0});const n=e.target;n.setPointerCapture(e.pointerId),n.classList.remove("grab"),n.classList.add("grabbing");const i=document.createElement("div");i.classList.add("drag-image"),document.body.appendChild(i),k($`<span>${V(t)}</span>`,i);function o(l){const c=g(l);i.style.cssText=`transform: translate(${c.x}px, ${c.y}px);`}o(e);function s(l){f({transforming:!1}),n.classList.add("grab"),n.classList.remove("grabbing"),i.remove(),Gt(t,w(g(l))),n.removeEventListener("pointermove",r),n.removeEventListener("pointerup",s),n.removeEventListener("pointercancel",s)}function r(l){l.preventDefault(),o(l)}n.addEventListener("pointermove",r),n.addEventListener("pointerup",s),n.addEventListener("pointercancel",s)}function le(){return $`<div class="modal toolbox">
    <div class="modal-title">
      <i class="fa-solid fa-toolbox"></i>
      <span>toolbox</span>
    </div>
    <div class="modal-content">
      ${Object.keys(a.toolbox).map(e=>$`<div
            class="modal-entry grab"
            @pointerdown=${t=>ae(t,e)}>
            ${V(e)}
          </div>`)}
    </div>
  </div>`}function ce(e){let t=a.pan,n=g(e);const i=e.target;i.setPointerCapture(e.pointerId),f({transforming:!0});function o(r){f({transforming:!1}),i.removeEventListener("pointermove",s),i.removeEventListener("pointerup",o),i.removeEventListener("pointercancel",o)}function s(r){r.preventDefault(),f({pan:{x:t.x-Math.floor(n.x-g(r).x),y:t.y-Math.floor(n.y-g(r).y)}})}i.addEventListener("pointermove",s),i.addEventListener("pointerup",o),i.addEventListener("pointercancel",o)}function de(e,t){const n={x:(e.x-a.pan.x)/a.scale,y:(e.y-a.pan.y)/a.scale};f({scale:t,pan:{x:e.x-n.x*t,y:e.y-n.y*t}})}function ue(e){const t=e.target.getBoundingClientRect(),n=Math.sign(e.deltaY)>0?a.scale*.9:a.scale*1.1;de({x:e.clientX-t.left,y:e.clientY-t.top},n)}function pe(e,t){let n=a.portInspection[t],i=w(g(e));const o=e.target;o.setPointerCapture(e.pointerId),f({transforming:!0}),o.classList.remove("grab"),o.classList.add("grabbing");function s(l){f({transforming:!1}),o.classList.add("grab"),o.classList.remove("grabbing"),o.removeEventListener("pointermove",r),o.removeEventListener("pointerup",s),o.removeEventListener("pointercancel",s)}function r(l){l.preventDefault();const c=w(g(l));let d=n.x-Math.floor(i.x-c.x),u=n.y-Math.floor(i.y-c.y);f({portInspection:{...a.portInspection,[t]:{x:d,y:u}}})}o.addEventListener("pointermove",r),o.addEventListener("pointerup",s),o.addEventListener("pointercancel",s)}function fe(){return Object.entries(a.portInspection).map(([e,t])=>{const[n,i]=e.split(":"),o=a.toolchain.tools[n].outputConfig[i],s=pt(n,i,"out");return $`<div
      class="port-window grab"
      data-portwindowid=${e}
      @pointerdown=${r=>pe(r,e)}
      style="transform: translate(${t.x}px, ${t.y}px); --color: var(${s});">
      <div class="port-window-title">
        ${i}
        <i
          @click=${()=>{const{[e]:r,...l}=a.portInspection;f({portInspection:l})}}
          class="fa-solid fa-rectangle-xmark"></i>
      </div>
      <div class="port-window-content">
        <div>type</div>
        <div class="port-type">${o.type}</div>
        <div>value</div>
        <div class="port-value">
          ${o.value===void 0?"undefined":o.value.toString()}
        </div>
      </div>
    </div>`})}function he(e){const t=document.querySelector(`[data-portwindowid="${e}"]`);if(!t)return!1;const n=t.getBoundingClientRect();return w({x:n.left,y:n.top+n.height/2})}function ve(){return Object.entries(a.portInspection).map(([e,t])=>{const[n,i]=e.split(":"),o=pt(n,i,"out"),s=H(q({toolID:n,portID:i},"out")),r=he(e);return r?J`<line  x1=${s.x} y1=${s.y} x2=${r.x-2} y2=${r.y} stroke="var(--base0)" stroke-width="3px" />
        <circle fill="var(--base0)" cx="${r.x}" cy="${r.y}" r="6.5px" />
    <line x1=${s.x} y1=${s.y} x2=${r.x-2} y2=${r.y} stroke="var(${o})" stroke-width="2px" />
    <circle fill="var(${o})" cx="${r.x}" cy="${r.y}" r="6px" />`:v})}function me(){return $`
    ${re()} ${Tt(a.showExamples,ge)}
    <div id="workspace">
      ${le()}
      <canvas
        draggable="false"
        id="background"
        @pointerdown=${e=>ce(e)}
        @wheel=${e=>ue(e)}></canvas>
      <svg
        class="svg-layer"
        preserveAspectRatio="xMidYMid meet"
        draggable="false">
        <g id="select-box-container" class="transform-group">
          ${a.selectBox.start&&a.selectBox.end?drawSelectBox(a):v}
        </g>
        <g id="pipes-container" class="transform-group"></g>
        <g id="port-inspection-lines" class="transform-group">
          ${ve()}
        </g>
      </svg>
      <div id="tool-ui" class="workspace-layer transform-group"></div>
      <svg
        id="dangling-pipe"
        class="svg-layer"
        preserveAspectRatio="xMidYMid meet"
        draggable="false">
        <g id="dangling-pipe-container" class="transform-group"></g>
      </svg>
      <div class="port-inspection workspace-layer transform-group">
        ${fe()}
      </div>
    </div>
  `}function ge(){return $`<div class="modal examples">
    <div class="modal-title">Examples</div>
    <div class="modal-content">
      ${Object.keys(a.examples).map(e=>$`<div
            @click=${()=>{f({showExamples:!1}),ne(e)}}
            class="modal-entry">
            ${V(e)}
          </div>`)}
    </div>
  </div>`}function F(e,t){return`M${e.x},${e.y}
    C${e.x+100},${e.y}
    ${t.x-100},${t.y}
    ${t.x},${t.y}`}function $e(e,t,n){return e=="in"?F(n,t):F(t,n)}function _e(){if(a.danglingPipe){const{side:e,originPort:t,endCoords:n}=a.danglingPipe,i=H(t);return J`<path class="pipe-progress" d=${$e(e,i,n)} /><circle class="pipe-start" cx="${n.x}" cy="${n.y}" r="5" />`}return v}function ye({start:e,end:t}){let n=q(e,"out"),i=q(t,"in");if(!(!n||!i))return{start:H(n),end:H(i)}}function be({toolID:e,portID:t},n){f({portInspection:{...a.portInspection,[`${e}:${t}`]:n}})}function Ae(){return Object.entries(a.toolchain.pipes).map(([e,t])=>{const{start:n,end:i}=ye(t),o=F(n,i);return J`<path class="pipe-background"  data-pipeid=${e} d="${o}" />
    <path class="pipe" data-pipeid=${e} @click=${s=>be(t.start,w(g(s)))} @contextmenu=${s=>{s.preventDefault(),te(e)}} d="${o}" />`})}function xe(){Object.entries(a.toolchain.tools).forEach(([e,t])=>{ht(t,a.layout[e])}),Y()}function st(){document.querySelectorAll(".transform-group").forEach(t=>{t.style.cssText=`transform: translate(${a.pan.x}px, ${a.pan.y}px) scale(${a.scale})`}),document.getElementById("background").style.cssText=`--offset-x: ${a.pan.x}px;--offset-y: ${a.pan.y}px;--scale: ${a.scale};`,Y()}function Y(){k(Ae(),document.getElementById("pipes-container")),k(_e(),document.getElementById("dangling-pipe-container"))}function Ee(){Object.entries(a.toolchain.tools).forEach(([e,t])=>{ft(e,t)})}function yt(){k(me(),document.body),Ee(),Y(),window.requestAnimationFrame(yt)}function we(){Object.entries(a.theme).map(([e,t])=>{document.documentElement.style.setProperty(e,t)})}function Pe(){yt(),we(),O.subscribe("layout",xe),O.subscribe("pan",st),O.subscribe("scale",st)}window.onload=Pe;export{k as D,$ as x};
